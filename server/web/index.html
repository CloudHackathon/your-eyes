<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>你是我的眼</title>
</head>
<body>
你是我的眼

<form id="uploadForm" action="/upload.php" enctype="multipart/form-data" method="post">
    <div class="uploadfile">
        <input id="uploadfile" type="file" name="file" accept="image/*" capture="camera">
    </div>
</form>

<script src="http://cdn.tig.qq.com/wwq/lib/frozenjs/zepto.min.js?v=1167"></script>
<script src="http://cdn.tig.qq.com/wwq/lib/lrz.all.bundle.js?v=1167"></script>
<script>
    $(function() {
        $('#uploadfile').change(function() {
            var xhr = new XMLHttpRequest();
            xhr.addEventListener('load', function(res) {
                res = JSON.parse(res.target.response);

                if (res.code === 0){
                    for(var i=0; i<res.tags.length; i++){
                        console.log(res.tags[i])
                    }
                }else{
                    alert(res.message)
                }
                console.log(res)
            });
            xhr.open('post', $('#uploadForm').attr('action'));
            $.each($('#uploadfile').get(0).files, function(_, file) {
                lrz(file, {width: 800, quality: 1, fieldName: 'file'}).then(function(rst) {
                    xhr.send(rst.formData);
                });
            });
        });
    });

</script>
</body>
</html>